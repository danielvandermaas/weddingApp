{"ast":null,"code":"var _jsxFileName = \"/home/daniel/Projecten/weddingApp/src/components/Tuin.js\";\nimport React, { Component } from 'react';\nimport { Map, TileLayer, Pane, Marker, Popup, Circle, GeoJSON } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css'; //markerfix\n\nconst markerSize = {\n  x: 17,\n  y: 24\n};\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: '/images/marker-2x.svg',\n  iconUrl: '/images/marker.svg',\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\n  className: 'layerDivIcon',\n  iconSize: [markerSize.x * 2, markerSize.y * 2],\n  iconAnchor: [markerSize.x, markerSize.y * 2]\n});\n\nclass Tuin extends Component {\n  constructor(props) {\n    super(props);\n    this.leafletMap = null;\n\n    this.showPhoto = async imageId => {\n      this.props.addOnScreen('foto');\n      this.props.setImageId(imageId);\n    };\n\n    this.openWindow = url => {\n      var win = window.open('https://' + url, '_blank');\n      win.focus();\n    };\n\n    this.getMarkers = async layer => {\n      let body = {\n        'mapId': this.props.mapId,\n        'layer': layer,\n        'type': 'polygon'\n      };\n      let ids = await fetch('https://api.ellipsis-earth.com/v2/geometry/ids', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': this.props.token\n        },\n        body: JSON.stringify(body)\n      });\n      ids = await ids.json();\n      ids = ids.ids;\n      body = {\n        'mapId': this.props.mapId,\n        'elementIds': ids,\n        'type': 'polygon'\n      };\n      let geojson = await fetch('https://api.ellipsis-earth.com/v2/geometry/get', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': this.props.token\n        },\n        body: JSON.stringify(body)\n      });\n      geojson = await geojson.json();\n      let geoJsonElements = geojson.features.map(feature => {\n        let position = feature.geometry.coordinates;\n        position.reverse();\n        return /*#__PURE__*/React.createElement(Marker, {\n          map: this.refs.map,\n          position: position,\n          onClick: this.openWindow.bind(this, feature.properties.link),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 76,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(Popup, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 10\n          }\n        }, /*#__PURE__*/React.createElement(\"span\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 12\n          }\n        }, layer)));\n        this.setState({\n          ceremonie: geoJsonElements\n        });\n      });\n\n      if (layer == 'ceremonie') {\n        this.setState({\n          ceremonie: geoJsonElements\n        });\n      }\n\n      if (layer == 'ontvangst') {\n        this.setState({\n          ontvangst: geoJsonElements\n        });\n      }\n\n      if (layer == 'receptie') {\n        this.setState({\n          receptie: geoJsonElements\n        });\n      }\n    };\n\n    this.getPhotoMarkers = async () => {\n      let body = {\n        'mapId': this.props.mapId,\n        'layer': 'foto',\n        'type': 'polygon'\n      };\n      let ids = await fetch('https://api.ellipsis-earth.com/v2/geometry/ids', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': this.props.token\n        },\n        body: JSON.stringify(body)\n      });\n      ids = await ids.json();\n      ids = ids.ids;\n      body = {\n        'mapId': this.props.mapId,\n        'elementIds': ids,\n        'type': 'polygon'\n      };\n      let geojson = await fetch('https://api.ellipsis-earth.com/v2/geometry/get', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': this.props.token\n        },\n        body: JSON.stringify(body)\n      });\n      geojson = await geojson.json();\n      let geoJsonElements = geojson.features.map(async feature => {\n        //with feature id collect messageId\n        body = {\n          'mapId': this.props.mapId,\n          'type': 'polygon',\n          'filters': {\n            'polygonIds': [feature.properties.id]\n          }\n        };\n        let messages = await fetch('https://api.ellipsis-earth.com/v2/geoMessage/ids', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': this.props.token\n          },\n          body: JSON.stringify(body)\n        });\n        messages = await messages.json();\n        let position = feature.geometry.coordinates;\n        position.reverse();\n        return /*#__PURE__*/React.createElement(Marker, {\n          map: this.refs.map,\n          position: position,\n          onClick: this.showPhoto.bind(this, messages.messages[0].id),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(Popup, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 10\n          }\n        }, /*#__PURE__*/React.createElement(\"span\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 12\n          }\n        }, \"foto\")));\n      });\n      let result = await Promise.all(geoJsonElements);\n      this.setState({\n        foto: result\n      });\n    };\n\n    this.flyToPos = async pos => {\n      let leafletElement = this.leafletMap.current.leafletElement;\n      leafletElement.flyTo(pos.coords, pos.zoom, {\n        'duration': 6\n      });\n    };\n\n    this.checkState = () => {\n      console.log('hoi');\n    };\n\n    this.leafletMap = React.createRef();\n    this.state = {\n      'ceremonie': [],\n      'ontvangst': [],\n      'receptie': [],\n      'photoMarkers': [],\n      'position': {\n        'coords': [51.98126, 5.82501],\n        'zoom': 18\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.flyToPos(this.state.position);\n    this.getMarkers('ceremonie');\n    this.getMarkers('ontvangst');\n    this.getMarkers('receptie');\n    this.getPhotoMarkers();\n  }\n\n  componentWillUnmount() {\n    this.props.setPosition(this.state.position);\n  }\n\n  render() {\n    let fullStyle = {\n      height: '1000px',\n      width: '1000px'\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: fullStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"button\",\n      value: \"check state\",\n      onClick: this.checkState,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(Map, {\n      center: this.props.position.coords,\n      zoom: this.props.position.zoom,\n      style: fullStyle,\n      ref: this.leafletMap,\n      maxNativeZoom: 21,\n      maxZoom: 21,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Pane, {\n      style: {\n        'zIndex': 100\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(TileLayer, {\n      url: \"https://www.google.com/maps/vt?lyrs=y@189&x={x}&y={y}&z={z}\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Pane, {\n      style: {\n        'zIndex': 150\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TileLayer, {\n      url: 'https://api.ellipsis-earth.com/v2/tileService/dd3cee74-98ec-4fd6-bd7a-7fdd3bb409d1/3/rgb/{z}/{x}/{y}?token=' + this.props.token.substring(7, this.props.token.length),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(Pane, {\n      style: {\n        zIndex: 200\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }\n    }, this.state.ceremonie, this.state.ontvangst, this.state.receptie, this.state.foto)));\n  }\n\n}\n\n;\nexport default Tuin;","map":{"version":3,"sources":["/home/daniel/Projecten/weddingApp/src/components/Tuin.js"],"names":["React","Component","Map","TileLayer","Pane","Marker","Popup","Circle","GeoJSON","L","markerSize","x","y","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","require","className","iconSize","iconAnchor","Tuin","constructor","props","leafletMap","showPhoto","imageId","addOnScreen","setImageId","openWindow","url","win","window","open","focus","getMarkers","layer","body","mapId","ids","fetch","method","headers","token","JSON","stringify","json","geojson","geoJsonElements","features","map","feature","position","geometry","coordinates","reverse","refs","bind","properties","link","setState","ceremonie","ontvangst","receptie","getPhotoMarkers","id","messages","result","Promise","all","foto","flyToPos","pos","leafletElement","current","flyTo","coords","zoom","checkState","console","log","createRef","state","componentDidMount","componentWillUnmount","setPosition","render","fullStyle","height","width","substring","length","zIndex"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {\n  Map,\n  TileLayer,\n  Pane,\n  Marker,\n  Popup,\n  Circle,\n  GeoJSON\n} from 'react-leaflet';\nimport L from 'leaflet'\nimport 'leaflet/dist/leaflet.css';\n\n//markerfix\nconst markerSize = {x: 17, y: 24};\n\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: '/images/marker-2x.svg',\n  iconUrl: '/images/marker.svg',\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\n  className: 'layerDivIcon',\n  iconSize: [markerSize.x * 2, markerSize.y * 2],\n  iconAnchor: [markerSize.x, markerSize.y * 2],\n});\n\n\nclass Tuin extends Component {\n\n  leafletMap = null\n\n  constructor(props) {\n    super(props);\n\n    this.leafletMap = React.createRef();\n\n    this.state = {'ceremonie':[], 'ontvangst':[], 'receptie':[], 'photoMarkers':[], 'position':{'coords': [51.98126,5.82501], 'zoom':18}}\n  }\n\n  componentDidMount() {\n  this.flyToPos(this.state.position)\n  this.getMarkers('ceremonie')\n  this.getMarkers('ontvangst')\n  this.getMarkers('receptie')\n  this.getPhotoMarkers()\n  }\n\ncomponentWillUnmount(){\n  this.props.setPosition(this.state.position)\n\n}\n\n  showPhoto = async (imageId) => {\n  this.props.addOnScreen('foto')\n  this.props.setImageId(imageId)\n  }\n\n  openWindow = (url) => {\n    var win = window.open('https://' + url, '_blank');\n    win.focus();\n  }\n\ngetMarkers= async (layer) =>{\n  let body = {'mapId':this.props.mapId, 'layer':layer, 'type':'polygon'}\n  let ids = await fetch('https://api.ellipsis-earth.com/v2/geometry/ids',{method:'POST',  headers: {'Content-Type': 'application/json', 'Authorization': this.props.token}, body:JSON.stringify(body)});\n  ids = await ids.json()\n  ids = ids.ids\n  body = {'mapId':this.props.mapId, 'elementIds':ids, 'type':'polygon'}\n  let geojson = await fetch('https://api.ellipsis-earth.com/v2/geometry/get',{method:'POST',  headers: {'Content-Type': 'application/json', 'Authorization': this.props.token}, body:JSON.stringify(body)});\n  geojson = await geojson.json()\n\n  let geoJsonElements = geojson.features.map((feature) => {\n    let position = feature.geometry.coordinates\n    position.reverse()\n    return (\n      <Marker map={this.refs.map} position={position} onClick= {this.openWindow.bind(this, feature.properties.link)} >\n         <Popup>\n           <span>{layer}</span>\n         </Popup>\n       </Marker>\n    );\n    this.setState({ceremonie:geoJsonElements})\n  });\n\n  if(layer == 'ceremonie'){\n    this.setState({ceremonie:geoJsonElements})\n  }\n  if(layer == 'ontvangst'){\n    this.setState({ontvangst:geoJsonElements})\n  }\n  if(layer == 'receptie'){\n    this.setState({receptie:geoJsonElements})\n  }\n\n}\n\ngetPhotoMarkers = async () =>{\n  let body = {'mapId':this.props.mapId, 'layer':'foto', 'type':'polygon'}\n  let ids = await fetch('https://api.ellipsis-earth.com/v2/geometry/ids',{method:'POST',  headers: {'Content-Type': 'application/json', 'Authorization': this.props.token}, body:JSON.stringify(body)});\n  ids = await ids.json()\n  ids = ids.ids\n\n  body = {'mapId':this.props.mapId, 'elementIds':ids, 'type':'polygon'}\n  let geojson = await fetch('https://api.ellipsis-earth.com/v2/geometry/get',{method:'POST',  headers: {'Content-Type': 'application/json', 'Authorization': this.props.token}, body:JSON.stringify(body)});\n  geojson = await geojson.json()\n\n  let geoJsonElements = geojson.features.map( async (feature) => {\n    //with feature id collect messageId\n  body = {'mapId':this.props.mapId, 'type':'polygon', 'filters':{'polygonIds':[feature.properties.id]}}\n  let messages = await fetch('https://api.ellipsis-earth.com/v2/geoMessage/ids',{method:'POST',  headers: {'Content-Type': 'application/json', 'Authorization': this.props.token}, body:JSON.stringify(body)});\n  messages = await messages.json()\n    let position = feature.geometry.coordinates\n    position.reverse()\n    return (\n      <Marker map={this.refs.map} position={position} onClick= {this.showPhoto.bind(this, messages.messages[0].id)} >\n         <Popup>\n           <span>foto</span>\n         </Popup>\n       </Marker>\n    );\n  });\n  let result = await Promise.all(geoJsonElements)\n  this.setState({foto:result})\n\n}\n\n  flyToPos = async (pos) => {\n    let leafletElement = this.leafletMap.current.leafletElement\n    leafletElement.flyTo(pos.coords, pos.zoom, {'duration':6});\n  }\n\n\n\ncheckState = () => {\n  console.log('hoi')\n}\n\n  render(){\n    let fullStyle = { height: '1000px', width: '1000px' };\n    return(\n      <div style = {fullStyle}>\n      <input type='button' value = 'check state' onClick={this.checkState}/>\n      <Map center={this.props.position.coords} zoom={this.props.position.zoom} style={fullStyle} ref={this.leafletMap} maxNativeZoom={21} maxZoom={21}>\n      <Pane style = {{'zIndex':100}}>\n        <TileLayer\n          url='https://www.google.com/maps/vt?lyrs=y@189&x={x}&y={y}&z={z}'\n        />\n        </Pane>\n        <Pane style = {{'zIndex':150}}>\n          <TileLayer\n          url={'https://api.ellipsis-earth.com/v2/tileService/dd3cee74-98ec-4fd6-bd7a-7fdd3bb409d1/3/rgb/{z}/{x}/{y}?token=' + this.props.token.substring(7,this.props.token.length)}\n          />\n          </Pane>\n        <Pane style={{ zIndex: 200 }}>\n          {this.state.ceremonie}\n          {this.state.ontvangst}\n          {this.state.receptie}\n          {this.state.foto}\n        </Pane>\n        </Map>\n      </div>\n    )\n  }\n\n};\nexport default Tuin;\n"]},"metadata":{},"sourceType":"module"}